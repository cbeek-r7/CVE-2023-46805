import requests
import urllib3
import csv
urllib3.disable_warnings()


print("\033[94m===================================")
print("Ivanti Scanner CVE-2023-46805")
print("       by @ChristiaanBeek    ")
print("===================================\033[0m")

ENDPOINT = "/api/v1/configuration/users/user-roles/user-role/rest-userrole1/web/web-bookmarks/bookmark"

# Read IP addresses from a text file
with open('ip_list.txt', 'r') as file:
    ip_addresses = file.read().splitlines()


with open('output.csv', 'w', newline='') as csv_file:
    writer = csv.writer(csv_file)
    # Write the header
    writer.writerow(["IP Address", "Status"])

    for ip_san in ip_addresses:
        url = "https://" + ip_san + ENDPOINT
        try:
            response = requests.get(url, verify=False, timeout=3) 
            if response.headers.get('content-type') is None:
                status = "Vulnerable Ivanti Device!"
            else:
                status = "XML Mitigation Applied!"
        except Exception as e:
            status = "Connection error"

        print(ip_san, status)
        writer.writerow([ip_san, status])
